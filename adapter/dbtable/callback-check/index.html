<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="laminas-authentication"> 

    
    
    <meta name="docsearch:version" content="latest">
    <meta name="docsearch:language" content="en">
    <meta name="docsearch:component" content="laminas-authentication">

    <link rel="canonical" href="https://docs.laminas.dev/laminas-authentication/adapter/dbtable/callback-check/">
    <link rel="shortcut icon" href="https://docs.laminas.dev/img/trademark-laminas-foundation-rgb.svg">

    <title>CallbackCheck - laminas-authentication - Laminas Docs</title>

    <link rel="stylesheet" href="https://docs.laminas.dev/css/styles.css">
    
</head>
<body id="page-top" class="components" data-spy="scroll" data-target=".toc" data-offset="20">

    
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container">
        
        <a class="logo-link navbar-brand" href="https://getlaminas.org/" data-tooltip data-placement="bottom" title="Go to the Laminas homepage">
            <img src="https://docs.laminas.dev/img/laminas-foundation-white.svg" height="28" alt="Laminas">
        </a>
        <a class="navbar-title" href="https://docs.laminas.dev/" data-tooltip data-placement="bottom" title="Go to the Laminas Documentation">
            Documentation
        </a>

        
        <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">

            
            <ul class="navbar-nav ml-auto">
                <li class="nav-item">
                    <div class="dropdown sub-project-selector">
                        <a class="dropdown-toggle nav-link" data-toggle="dropdown" aria-expanded="false">
                            All Docs
                        </a>
                        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                            <a href="https://docs.mezzio.dev/" class="dropdown-item">
                                <div class="row align-items-center">
                                    <div class="col-md-4 col-sm-12">
                                        <img src="https://docs.laminas.dev/img/laminas-mezzio-rgb.svg">
                                    </div>
                                    <div class="col-md-8 col-sm-12">
                                        <strong>Mezzio</strong><br>
                                        PSR-15 Middleware in Minutes
                                    </div>
                                </div>
                            </a>
                            <a href="https://docs.laminas.dev/components/" class="dropdown-item">
                                <div class="row align-items-center">
                                    <div class="col-md-4 col-sm-12">
                                        <img src="https://docs.laminas.dev/img/laminas-components-rgb.svg">
                                    </div>
                                    <div class="col-md-8 col-sm-12">
                                        <strong>Components</strong><br>
                                        Components for Enterprise Applications
                                    </div>
                                </div>
                            </a>
                            <a href="https://docs.laminas.dev/mvc" class="dropdown-item">
                                <div class="row align-items-center">
                                    <div class="col-md-4 col-sm-12">
                                        <img src="https://docs.laminas.dev/img/laminas-mvc-rgb.svg">
                                    </div>
                                    <div class="col-md-8 col-sm-12">
                                        <strong>MVC</strong><br>
                                        MVC for Enterprise Applications
                                    </div>
                                </div>
                            </a>
                            <a href="https://api-tools.getlaminas.org/documentation" class="dropdown-item">
                                <div class="row align-items-center">
                                    <div class="col-md-4 col-sm-12">
                                        <img src="https://docs.laminas.dev/img/laminas-api-tools-rgb.svg">
                                    </div>
                                    <div class="col-md-8 col-sm-12">
                                        <strong>API Tools</strong><br>
                                        Build RESTful APIs in Minutes
                                    </div>
                                </div>
                            </a>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item dropdown-item--secondardy" href="https://docs.laminas.dev/migration/">
                                <div class="row align-items-center">
                                    <div class="col-md-8 offset-md-4 col-sm-12">
                                        Migration to Laminas
                                    </div>
                                </div>
                            </a>
                            <a class="dropdown-item dropdown-item--secondardy" href="https://docs.laminas.dev/tutorials/">
                                <div class="row align-items-center">
                                    <div class="col-md-8 offset-md-4 col-sm-12">
                                        Tutorials
                                    </div>
                                </div>
                            </a>
                        </div>
                    </div>
                </li>
                <li class="nav-item">
                    <a href="https://getlaminas.org/participate" class="nav-link">Community</a>
                </li>
            </ul>

            
            
                <div class="d-block d-sm-none">
                    
    <div class="subnavigation hidden-print">
        <h4 class="subnavigation__title">
            <a href="../../..">laminas-authentication</a>
        </h4>

        <h5 class="subnavigation__subtitle">Table of Contents</h5>

        <ul class="subnavigation__list">
            

                
                

                    
                    
                        
                            <li class="subnavigation__list-item ">
                                <a href="../../../intro/" class="subnavigation__link">Intro</a>
                            </li>
                        
                    
                
            

                
                

                    
                    
                        
                            <li class="subnavigation__list-item">
                                <span class="subnavigation__headline">Adapters</span>
                                <ul class="subnavigation__list">
                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../../intro/" class="subnavigation__link">Intro</a>
    </li>

                                    
                                        
    <li class="subnavigation__list-item">
        <span class="subnavigation__headline">DbTable</span>
        <ul class="subnavigation__list">
            
                
    <li class="subnavigation__list-item ">
        <a href="../intro/" class="subnavigation__link">Intro</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../credential-treatment/" class="subnavigation__link">CredentialTreatmentAdapter</a>
    </li>

            
                
    <li class="subnavigation__list-item subnavigation__list-item--active">
        <a href="./" class="subnavigation__link">CallbackCheck</a>
    </li>

            
        </ul>
    </li>

                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../../digest/" class="subnavigation__link">Digest</a>
    </li>

                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../../http/" class="subnavigation__link">HTTP</a>
    </li>

                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../../ldap/" class="subnavigation__link">LDAP</a>
    </li>

                                    
                                </ul>
                            </li>
                        
                    
                
            

                
                

                    
                    
                        
                            <li class="subnavigation__list-item ">
                                <a href="../../../storage/" class="subnavigation__link">Identity Persistence</a>
                            </li>
                        
                    
                
            

                
                

                    
                    
                        
                            <li class="subnavigation__list-item ">
                                <a href="../../../validator/" class="subnavigation__link">Validation</a>
                            </li>
                        
                    
                
            
        </ul>
    </div>

                </div>
            

            
            <div class="d-block d-sm-none">
                <div class="component-selector">
    
    <h5 class="component-selector__subtitle">Find documentation…</h5>
    <select class="form-control component-selector__control">
        <option value="/">Overview</option>
        <optgroup label="Components"></optgroup>
    </select>
</div>
            </div>
        </div>
    </div>
</nav>

    
    <header class="header">
    <div class="container">
        <div class="row">

            
            <div class="col-8">
                <h1 class="header__title">
                    Components

                    
                        <small class="header__subtitle">laminas-authentication</small>
                    
                </h1>
            </div>

            
            <div class="col-4 text-right">
                
                    

                    <a href="#" class="header__link header__link--search" data-toggle="modal" data-target="#mkdocs_search_modal" title="Open search">
                        <i class="fa fa-search"></i> Search
                    </a>
                    <a href="https://github.com/laminas/laminas-authentication/" class="header__link header__link--github" title="Go to repository of laminas-authentication">
                        <i class="fa fa-github"></i> GitHub
                    </a>
                
            </div>
        </div>
    </div>
</header>

    
    <div class="container">
        <div class="row">
            <div class="col-md-9 col-sm-12 content" role="main">
                
                
                    
    

    
    
        <div class="toc">
            <h6 class="toc__headline">On this page</h6>
            <ul class="toc__list">
                
                    <li class="toc__entry">
                        <a href="#configuration-options" class="toc__link nav-link">Configuration options</a>
                    </li>
                
                    <li class="toc__entry">
                        <a href="#basic-usage" class="toc__link nav-link">Basic Usage</a>
                    </li>
                
                    <li class="toc__entry">
                        <a href="#advanced-usage" class="toc__link nav-link">Advanced Usage</a>
                    </li>
                
            </ul>
        </div>
    

                

                
                    <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        
            <li class="breadcrumb-item"><a href="https://docs.laminas.dev/">Overview</a></li>
            <li class="breadcrumb-item"><a href="https://docs.laminas.dev/components/">Components</a></li>

            
                <li class="breadcrumb-item"><a href="../../..">laminas-authentication</a></li>

                
                    
                        
                        
                            <li class="breadcrumb-item">Adapters</li>
                        
                    
                
                    
                        
                        
                            <li class="breadcrumb-item">DbTable</li>
                        
                    
                

                <li class="breadcrumb-item active" aria-current="page">CallbackCheck</li>
            
        
    </ol>
</nav>






    
    
        <h2 class="chapter__headline">DbTable</h2>
    

    <h1 id="callback-verification">Callback Verification</h1>
<p>Some verification operations cannot be performed well on RDBMS servers. Other
times, you may be unsure which RDBMS system you will be using long-term, and
need to ensure authentication will work consistently. For these situations, you
can use the <code>Laminas\Authentication\Adapter\DbTable\CallbackCheckAdapter</code> adapter.
Similar to the <a href="../credential-treatment/">CredentialTreatmentAdapter</a>, it
accepts a table name, identity column, and credential column; however, instead
of a credential treatment, it accepts a <em>credential validation callback</em> that
is executed when the database returns any matches, and which can be used to
perform additional credential verifications.</p>
<h2 id="configuration-options">Configuration options</h2>
<p>The available configuration options include:</p>
<ul>
<li><code>tableName</code>: This is the name of the database table that contains the
  authentication credentials, and against which the database authentication
  query is performed.</li>
<li><code>identityColumn</code>: This is the name of the database table column used to
  represent the identity.  The identity column must contain unique values, such
  as a username or e-mail address.</li>
<li><code>credentialColumn</code>: This is the name of the database table column used to
  represent the credential. Under a simple identity and password authentication
  scheme, the credential value corresponds to the password.</li>
<li><code>credentialValidationCallback</code>: A PHP callable to execute when the database returns matches. The callback will receive:</li>
<li>the value of the <code>credentialColumn</code> returned from the database</li>
<li>the credential that was used by the adapter during authentication</li>
</ul>
<h2 id="basic-usage">Basic Usage</h2>
<p>Many databases do not provide functions that implement a cryptographically
secure hashing mechanism. Additionally, you may want to ensure that should you
switch database systems, hashing is consistent. This is a perfect use case for
the <code>CallbackCheckAdapter</code> adapter; you can implement the password hashing and
verification within PHP instead.</p>
<p>The following code creates an adapter for an in-memory database, creates a
simple table schema, and inserts a row against which we can perform an
authentication query later. This example requires the PDO SQLite extension to
be available:</p>
<pre class="highlight"><code class="language-php">use Laminas\Db\Adapter\Adapter as DbAdapter;

// Create a SQLite database connection
$dbAdapter = new DbAdapter([
    'driver'   =&gt; 'Pdo_Sqlite',
    'database' =&gt; 'data/sqlite.db',
]);

// Build a simple table creation query
$sqlCreate = 'CREATE TABLE [users] ('
    . '[id] INTEGER  NOT NULL PRIMARY KEY, '
    . '[username] VARCHAR(50) UNIQUE NOT NULL, '
    . '[password] VARCHAR(255) NULL, '
    . '[real_name] VARCHAR(150) NULL)';

// Create the authentication credentials table
$dbAdapter-&gt;query($sqlCreate);

// Build a query to insert a row for which authentication may succeed
$sqlInsert = "INSERT INTO users (username, password, real_name) "
    . "VALUES ('my_username', 'my_password', 'My Real Name')";

// Insert the data
$dbAdapter-&gt;query($sqlInsert);</code></pre>
<p>As you add users, you will need to create a hash of the password provided and
insert that into the database. For users on PHP 5.5+, you can use
<a href="http://php.net/password_hash">password_hash()</a>:</p>
<pre class="highlight"><code class="language-php">$hash = password_hash($password, PASSWORD_DEFAULT);</code></pre>
<blockquote>
<h3 id="password-hash-length">Password hash length</h3>
<p>As of the time of writing, PHP uses a bcrypt algorithm by default for hashing
passwords with <code>password_hash()</code>, and this produces 60 character strings. However,
the default may change over time, and php.net recommends using 255 character
fields for storage to allow for larger hash sizes in the future.</p>
</blockquote>
<p>To verify a password, we'll create a callback that uses
<a href="http://php.net/manual/en/function.password-verify.php">password_verify()</a>:</p>
<pre class="highlight"><code class="language-php">$passwordValidation = function ($hash, $password) {
    return password_verify($password, $hash);
};</code></pre>
<p>Now that we have the database connection and a password validation function,
we can create our <code>Laminas\Authentication\Adapter\DbTable\CallbackCheckAdapter</code> adapter
instance, passing the options to the constructor or later via setter methods:</p>
<pre class="highlight"><code class="language-php">use Laminas\Authentication\Adapter\DbTable\CallbackCheckAdapter as AuthAdapter;

// Configure the instance with constructor parameters:
$authAdapter = new AuthAdapter(
    $dbAdapter,
    'users',
    'username',
    'password',
    $passwordValidation
);

// Or configure the instance with setter methods:
$authAdapter = new AuthAdapter($dbAdapter);

$authAdapter
    -&gt;setTableName('users')
    -&gt;setIdentityColumn('username')
    -&gt;setCredentialColumn('password')
    -&gt;setCredentialValidationCallback($passwordValidation);</code></pre>
<p>At this point, the authentication adapter instance is ready to accept
authentication queries. In order to formulate an authentication query, the
input credential values are passed to the adapter prior to calling the
<code>authenticate()</code> method:</p>
<pre class="highlight"><code class="language-php">// Set the input credential values (e.g., from a login form):
$authAdapter
    -&gt;setIdentity('my_username')
    -&gt;setCredential('my_password');

// Perform the authentication query, saving the result
$result = $authAdapter-&gt;authenticate();</code></pre>
<p>In addition to the availability of the <code>getIdentity()</code> method upon the
authentication result object, <code>Laminas\Authentication\Adapter\DbTable\CallbackCheckAdapter</code>
also supports retrieving the table row upon authentication success:</p>
<pre class="highlight"><code class="language-php">// Print the identity:
echo $result-&gt;getIdentity() . "\n\n";

// Print the result row:
print_r($authAdapter-&gt;getResultRowObject());

/* Output:
my_username

Array
(
    [id] =&gt; 1
    [username] =&gt; my_username
    [password] =&gt; my_password
    [real_name] =&gt; My Real Name
)
*/</code></pre>
<p>Since the table row contains the credential value, it is important to secure
the values against unintended access.</p>
<p>When retrieving the result object, we can either specify what columns to
return, or what columns to omit:</p>
<pre class="highlight"><code class="language-php">// Specify the columns to return:
$columnsToReturn = [
    'id',
    'username',
    'real_name',
];
print_r($authAdapter-&gt;getResultRowObject($columnsToReturn));

/* Output:

Array
(
   [id] =&gt; 1
   [username] =&gt; my_username
   [real_name] =&gt; My Real Name
)
*/

// Or specify the columns to omit; when using this approach,
// pass a null value as the first argument to getResultRowObject():
$columnsToOmit = ['password'];
print_r($authAdapter-&gt;getResultRowObject(null, $columnsToOmit);

/* Output:

Array
(
   [id] =&gt; 1
   [username] =&gt; my_username
   [real_name] =&gt; My Real Name
)
*/</code></pre>
<h2 id="advanced-usage">Advanced Usage</h2>
<p>While the basic use case will fit most scenarios, there may be cases where you have
specialized needs, such as additional criteria that needs to be met for a user to
match.</p>
<h3 id="adding-criteria-to-match">Adding criteria to match</h3>
<p>Since the validation callback is only provided the hash value from the database
and the credential provided by the user, you cannot do more complex matching
within it. However, you can add criteria to the SQL sent to the server by
retrieving the <code>Laminas\Db\Sql\Select</code> instance is uses.</p>
<p>As an example, many websites require a user to activate their account before
allowing them to login for the first time. We can add that criteria as follows:</p>
<pre class="highlight"><code class="language-php">// Create a basic adapter
$adapter = new AuthAdapter(
    $db,
    'users',
    'username',
    'password',
    $passwordValidation
);

// Now retrieve the Select instance and modify it:
$select = $adapter-&gt;getDbSelect();
$select-&gt;where('active = "TRUE"');

// Authenticate; this will include "users.active = TRUE" in the WHERE clause:
$adapter-&gt;authenticate();</code></pre>




    <nav>
    <ul class="page-nav hidden-print">

        
        <li class="page-nav__item">
            
                <a rel="prev" class="page-nav__link page-nav__link--prev" href="../credential-treatment/">
                    <small class="page-nav__label">Previous</small>
                    <i class="fa fa-chevron-left"></i>
                    CredentialTreatmentAdapter
                </a>
            
        </li>

        
        <li class="page-nav__item">
            
                <a rel="next" class="page-nav__link page-nav__link--next" href="../../digest/">
                    <small class="page-nav__label">Next</small>
                    Digest
                    <i class="fa fa-chevron-right"></i>
                </a>
            
        </li>
    </ul>
</nav>



                
            </div>
            <div class="col-md-3 col-sm-12 sidebar">
                <div class="donation-banner">
    <a href="https://getlaminas.org/support/">
        <h2>Donate</h2>
        <p>Support Laminas Developers Directly</p>
        <img src="https://funding.communitybridge.org/assets/cb-f-horizontal-white.svg">
    </a>
</div>

                
                    <div class="component-selector">
    
    <h5 class="component-selector__subtitle">Find documentation…</h5>
    <select class="form-control component-selector__control">
        <option value="/">Overview</option>
        <optgroup label="Components"></optgroup>
    </select>
</div>
                    
    <div class="subnavigation hidden-print">
        <h4 class="subnavigation__title">
            <a href="../../..">laminas-authentication</a>
        </h4>

        <h5 class="subnavigation__subtitle">Table of Contents</h5>

        <ul class="subnavigation__list">
            

                
                

                    
                    
                        
                            <li class="subnavigation__list-item ">
                                <a href="../../../intro/" class="subnavigation__link">Intro</a>
                            </li>
                        
                    
                
            

                
                

                    
                    
                        
                            <li class="subnavigation__list-item">
                                <span class="subnavigation__headline">Adapters</span>
                                <ul class="subnavigation__list">
                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../../intro/" class="subnavigation__link">Intro</a>
    </li>

                                    
                                        
    <li class="subnavigation__list-item">
        <span class="subnavigation__headline">DbTable</span>
        <ul class="subnavigation__list">
            
                
    <li class="subnavigation__list-item ">
        <a href="../intro/" class="subnavigation__link">Intro</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../credential-treatment/" class="subnavigation__link">CredentialTreatmentAdapter</a>
    </li>

            
                
    <li class="subnavigation__list-item subnavigation__list-item--active">
        <a href="./" class="subnavigation__link">CallbackCheck</a>
    </li>

            
        </ul>
    </li>

                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../../digest/" class="subnavigation__link">Digest</a>
    </li>

                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../../http/" class="subnavigation__link">HTTP</a>
    </li>

                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../../ldap/" class="subnavigation__link">LDAP</a>
    </li>

                                    
                                </ul>
                            </li>
                        
                    
                
            

                
                

                    
                    
                        
                            <li class="subnavigation__list-item ">
                                <a href="../../../storage/" class="subnavigation__link">Identity Persistence</a>
                            </li>
                        
                    
                
            

                
                

                    
                    
                        
                            <li class="subnavigation__list-item ">
                                <a href="../../../validator/" class="subnavigation__link">Validation</a>
                            </li>
                        
                    
                
            
        </ul>
    </div>

                    
                
            </div>
        </div>
    </div>

    
    <footer class="footer">
    <div class="container">

        
        <div class="row">
            <div class="col-md-12 text-center">
                <a class="footer__button" href="#page-top"><i class="fa fa-chevron-up" aria-hidden="true"></i></a>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
                <h5>Laminas</h5>
                <ul>
                    <li>Laminas Project <a href="https://getlaminas.org/">The new foundation for the community-supported, open source continuation of Zend Framework</a></li>
                    <li>Laminas Components and MVC <a href="https://docs.laminas.dev/">Components and MVC for enterprise applications</a></li>
                    <li>Mezzio <a href="https://docs.mezzio.dev/">PSR-15 middleware in minutes</a></li>
                    <li>Laminas API Tools <a href="https://api-tools.getlaminas.org/">Build RESTful APIs in minutes</a></li>
                </ul>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
                <div class="row">

                    
                    <div class="col-md-4">
                        <h4 class="footer__headline">Support</h4>
                        <ul class="support__list">
                            <li class="support__list-item">
                                <a href="https://discourse.laminas.dev" class="support__link" title="Forum"><i class="fa fa-comments"></i></a>
                            </li>
                            <li class="support__list-item">
                                <a href="https://laminas.dev/chat" class="support__link" title="Chat"><i class="fa fa-slack"></i></a>
                            </li>
                            <li class="support__list-item">
                                <a href="https://github.com/laminas" class="support__link" title="Github"><i class="fa fa-github"></i></a>
                            </li>
                            <li class="support__list-item">
                                <a href="https://twitter.com/getlaminas" class="support__link" title="Twitter"><i class="fa fa-twitter"></i></a>
                            </li>
                            <li class="support__list-item">
                                <a href="https://getlaminas.org/blog/rss.xml" class="support__link" title="Blog feed"><i class="fa fa-rss"></i></a>
                            </li>
                            <li class="support__list-item">
                                <a href="https://getlaminas.org/security/feed" class="support__link" title="Security feed"><i class="fa fa-rss-square"></i></a>
                            </li>
                        </ul>
                    </div>

                    
                    <div class="col-md-4">
                        <h4 class="footer__headline">License</h4>
                        <p>
                            Code licensed under <a
                                href="https://github.com/laminas/laminas-authentication/blob/master/LICENSE.md">BSD 3-Clause</a>.
                        </p>
                    </div>

                    
                    <div class="col-md-4">
                        <h4 class="footer__headline">Copyright</h4>
                        <p>
                            <!--Built with love by the Laminas team with the help of our
                            <a href="https://github.com/laminas/laminas-authentication/graphs/contributors">contributors</a>.<br>-->
                            &copy; 2022 <a href="https://getlaminas.org/">Laminas Project</a> a Series of LF Projects, LLC.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</footer>

    <script>
        let base_url = '../../..',
            project  = "components",
            siteName = 'laminas-authentication';
    </script>
    <script src="https://docs.laminas.dev/js/scripts.js"></script>
    
        <script src="../../../search/main.js"></script>
    

    
    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Search</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                    <span class="sr-only">Close</span>
                </button>
            </div>
            <div class="modal-body">
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search in laminas-authentication" id="mkdocs-search-query">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
        </div>
    </div>
</div>
</body>


</html>
